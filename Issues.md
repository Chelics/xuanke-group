# (已修改)数据库密码字段加长
student表, teacher表, staff表的password字段长度改为255, 因为加密后的密码会很长

# Interceptor拦截
目前除了"/login"不会被拦截, 所有页面均会被拦截, 拦截后会在前端的msg中显示"Not log in"
解决方法: 
1. 在数据库中添加账户信息: 其它字段照常添加, password字段需要添加加密后的密码.
    - 如何生成加密后的密码? 可在service下的UnitTest类中执行testEncodePassword方法生成"123456"加密后的密码, 复制到数据库表中(也可以将123456替换为其它密码)
2. 获取JWT令牌: 在Apifox中发送登录请求, 注意参数在body里面, 不在param, 填写数据库中匹配的username和明文密码, 返回sucess后复制data中的JWT令牌
3. 添加JWT令牌到请求中: 在要发送的请求中, 添加Header项: 参数名为token, 参数值为刚刚复制的JWT令牌, 此时发送请求将会被Interceptor放行

==粗暴的解决方法: 在config包下的WebConfig类中, 将`registry.addInterceptor(loginCheckInterceptor).addPathPatterns("/\**").excludePathPatterns("/login");
中的/login改为要发送的请求路径(包含所有子路径加/**), 即可使该请求不被Interceptor拦截==

# (已解决) 问题: username命名规则
如何定义username命名规则以区分教师, 学生和教务: 
com/seu/service/impl/LoginServiceImpl.java:22

当前设定: username第一位: 0表示学生, 1表示老师, 2表示教务, 如果是其他数字直接返回用户名或密码错误~

# 问题: 改用 HTTPS传输协议
用户登录时, 密码以明文形式从客户端传到服务端, 存在风险
方案一: 在前端用哈希, 盐和公钥等对密码进行加密, 传输密文
方案二: 改用HTTPS传输协议, 除了密码之外其他传输的信息也可以被加密, 大大降低了传输过程中泄露的风险, 但是需要SSL证书
- 自签名证书可以满足使用需要, 但是用户会收到不安全的提醒, 降低用户信任度
- 由受信任的证书颁发机构颁发的证书是最佳选项, 需要一点点钱:
  - 域名的价格是几十元
  - SSL证书的价格几十到几百不等, Sectigo上DV级别的单域名证书价格在99美元/年, 然而似乎也有一些方法可以免费获取一些受信任的SSL证书

# 问题: 教学楼的表示方式
"J1"/"教1"/"教学楼1"?, 目前采用"教1"表示

# 问题: 学生的全局搜索应该能搜索哪些字段
当前能搜索到的字段: 课程名, 课程编号, 开设学院, 教师姓名, 教室

# 问题: 各功能下返回的课程列表, 其中的课程应该按什么排序
当前排序规则: 未排序

# 问题: 如何判断当前所属的选课阶段可以选课
当前判断依据: 根据阶段名称是否含有subString("-开放选课")或subString("退改补")判断

<<<<<<< HEAD
# JWT令牌说明
[学习视频: JWT令牌](https://www.bilibili.com/video/BV1m84y1w7Tb?p=161&vd_source=844f7d302dc747984d15b12d2308da11)
## JWT令牌的三部分:
- Head: 只有alg: "HS256", base64编码, 任何拿到令牌的人都能解
- Payload: 如下, base64编码, 任何拿到令牌的人都能解
 {
  "name": "张三",
  "id": "1",
  "username": "01",
  "exp": 1716106773   //令牌有效期限
  }
- Signature: Head + Payload + 密钥生成的加密签名, 拿到令牌和密钥才能解(安全情况下, 密钥只在后端的配置文件里, JWTUtils类需要时会从中读取)

## 前端对JWT令牌的处理
用户输入正确的用户名和密码后, 后端返回登录成功信息, 在统一响应结果Result的data里含有JWT令牌, 前端需要保存此令牌, 令牌的有效期是一小时(后续开发过程中可能会修改)

前端在登录后, 每一次向系统发起的请求中, 必须带有规定格式的JWT令牌, 否则会被拦截, 请求会失败

如果请求失败, 考虑重定向到登录页(重定向的登录页URL应该由后端响应返回)

请求中JWT令牌的格式规定:
- 必须在请求头(Headers)中, 在请求体中无效
- 请求头的参数名称: Authorization, 参数类型String
- 请求头的内容: "Bearer " + JWT令牌, 两个字符串要合并为一个, 注意Bearer与令牌之间带一个空格

原则上前端只负责存储和发送令牌, 不应对令牌进行解密

## 后端对JWT令牌的处理
- 用户登录成功后, 将令牌连同登陆成功的消息一起相应给前端, 令牌无需添加响应头和Bearer字符串, 放在JSON中随响应体发送给前端
- 除了"/login"外, 没有有效令牌的所有请求全部拦截, 响应给前端错误信息
- 后端如果需要登录者本人的id, name, username信息, 原则上不应该再要求前端发送, 而是应该直接从令牌中解析获取

考虑实现令牌的自动续签或更新

# **自动排课SchedulerService功能说明**

以下内容仅作功能(需求)上的说明, 实现过程可以参考代码, 有作详细的注释说明

**没有对StaffCheckingServiceImpl类的返回结果进行修改, 无论排课成功与否, 返回的都是Result.success()**

**以下内容仅是对SchedulerService类功能的说明**

输入: 审核通过的课程列表

输出: 排课失败的课程列表 (不会输出排课成功的课程)

数据库操作: 
1. course表插入课程信息, 如果课程编号已存在, 不会做任何改动(不会插入相同记录, 也不会更新已有记录的值)
2. course_class表插入对应关系, 如果对应记录已存在, 不会做任何改动
3. course_teacher表插入对应关系, 如果对应记录已存在, 不会做任何改动

注意:
- 即使相关记录已存在, 也不会返回相关的错误或警告信息, 所有操作视为正常完成
- 即使course表中已有相同的课程编号, 仍然会尝试向course_class表和course_teacher表中插入记录

排课策略:
先排时间, 再排教室, 假设教室足够多, 即使全校所有班级同时上课, 也几乎能容纳

时间分配限制: 
1. 可以自动分配的课时数: 16, 24, 32, 48, 64, 80, 96(96课时只能每周三次, 2+2+2, 不能每周两次, 3+3)
2. 时间选择顺序: 
   - 隔周上课: 单周周一1-2节 -> 单周周日11-13节, 双周周一1-2节 -> 双周周一11-13节
   - 每周上课: 单双周周一1-2节 -> 单双周周日11-13节

教室选择策略:
0. 只找容量正好符合的, 如果当前课程只要40的容量, 但是容量40的教室全被占用, 容量80的还有空着的, 那也不能占80的教室
1. 第一优先级: 教1 > 教2 > ... > 教8
2. 第二优先级: 101 > 102 > 111 > ... > 508 > ...



---




以下内容是写排课方法时记下的, 不保证完全正确, 可以忽略不看

| 课时数 | 排课方案             | 课次                          | 周次    |
|-----|------------------|-----------------------------|-------|
| 16  | 8 * 2            | 0, 1, 3, 4, 6               | 0-13  |
| 24  | 8 * 3            | 2, 5, 7                     | 0-13  |
| 32  | 16 * 2           | 0, 1, 3, 4, 6               | 14-20 |
| 48  | 16 * 3           | 2, 5, 7                     | 14-20 |
| 64  | 16 * (2 + 2)     | 两组(0, 1, 3, 4, 6)           | 14-20 |
| 80  | 16 * (2 + 3)     | (0, 1, 3, 4, 6) + (2, 5, 7) | 14-20 |
| 96  | 16 * (2 + 2 + 2) | 三组(0, 1, 3, 4, 6)           | 14-20 |

2课时课次: 0, 1, 3, 4, 6

3课时课次: 2, 5, 7

| 编号 | 课次      |
|----|---------|
|0| 上午12    |
|1| 上午34    |
|2| 上午35    |
|3| 下午67    |
|4| 下午89    |
|5| 下午8-10  |
|6| 晚上11-12 |
|7| 晚上11-13 |
=======
#问题：自动分配算法

#问题：前端课表如何呈现(json格式见接口文档)
>>>>>>> deaf9a05ae932250df0c112ec1261c939249a434
